---
title: "Epicurves"
author: "Celine Victoria Berg-Hansen"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    fig_width: 6
    fig_height: 6
vignette: >
  %\VignetteIndexEntry{Epicurves}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


```{r}
library(ggplot2)
library(data.table)
library(splstyle)
```

## Data

We generally start with a linelist dataset (make sure it is a `data.table`!).

```{r}
d <- norway_covid19_cases_by_time_location

# There is a lot of data in this dataset, so we'll just use 2022 data here
d <- d[isoyear == 2022]

# We have one daily dataset
d_day <- d[granularity_time == "day"]

# We have one weekly dataset
d_week <- d[granularity_time == "isoweek"]
```

## Graphs for one geographical area

Daily epicurve for `norge`

```{r}
plot_epicurve(d_day[location_code == "norge"], 
              type = "single", 
              var_y = "covid19_cases_testdate_n", 
              var_x = "date",
              breaks_x = NULL,
              lab_main = "Daily epicurve for Norway",
              lab_y = "Cases")
```

Weekly epicurve for `norge`

```{r}
plot_epicurve(d_week[location_code == "norge"], 
              type = "single", 
              var_y = "covid19_cases_testdate_n", 
              lab_main = "Weekly epicurve for Norway",
              breaks_x = fhiplot::every_nth(n = 2),
              lab_y = "Cases")
```

## Epicurves for multiple geographical areas

When we have multiple geographical areas, we use the argument `facet_wrap` to create multiple epicurves.

Daily epicurve for all of the counties

```{r fig.height=10, fig.width=8}
plot_epicurve(d_day[granularity_geo == "county"],
              type = "single",
              var_y = "covid19_cases_testdate_n",
              var_x = "date",
              breaks_x = NULL,
              lab_main = "Daily epicurve for all the counties",
              facet_wrap = "location_code",
              lab_y = "Cases")
```

Weekly epicurve for all of the counties

```{r fig.height=10, fig.width=8}
plot_epicurve(d_week[granularity_geo == "county"],
              type = "single",
              var_y = "covid19_cases_testdate_n",
              lab_main = "Weekly epicurve for all the counties",
              facet_wrap = "location_code",
              facet_ncol = 4,
              lab_y = "Cases")
```

## Stacked epicurves

If you would like to add colours to differentiate between different variables. This can be done through `type = "stacked"` and the argument `fill_var`

```{r}

plot_epicurve(d_week[granularity_geo == "county"],
              type = "stacked",
              fill_var = "location_code",
              var_y = "covid19_cases_testdate_n",
              lab_main = "Weekly epicurve for all the counties",
              lab_y = "Cases")


```

## Dodged epicurves

If you would like to compare different variables. This can be done with the argument `type = "dodged"` and specifying what you want to compare with the argument `fill_var`.

```{r}

plot_epicurve(d_week[granularity_geo == "county" & location_code %in% c("county46", "county03", "county30")],
              type = "dodged",
              fill_var = "location_code",
              var_y = "covid19_cases_testdate_n",
              lab_y = "Cases")


```
